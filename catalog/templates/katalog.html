{% extends 'base.html' %} 
{% load static %}

{% block content %}
<style>
    .data{
        font-family: 'Mochiy Pop P One';
    }
</style>
<div>
    {% include 'navbar.html' %}

    <div class='max-w-6xl mx-auto mt-20 flex'>
        <div class="relative flex items-center w-full h-12 rounded-lg focus-within:shadow-lg bg-orange-100 overflow-hidden border-4 border-yellow-900">
            <div class="grid place-items-center h-full w-12 text-gray-300">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-yellow-900" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                </svg>
            </div>

            <input
            class="peer h-full w-full outline-none text-sm text-gray-700 px-2 bg-orange-100"
            type="text"
            id="search"
            placeholder="Search books..." /> 
        </div>
        
        <div class="relative inline-block">
            <div>
                <button id="showPopUpFilter" type="button">
                    <svg width="34" height="24" viewBox="0 0 49 39" fill="none" xmlns="http://www.w3.org/2000/svg" class="ml-2 mt-2">
                        <path d="M14.1594 4.24951H44.6378H14.1594Z" fill="white"/>
                        <path d="M14.1594 4.24951H44.6378" stroke="#FEFADD" stroke-width="8" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M4 4.2748L4.0254 4.24658L4 4.2748Z" fill="white"/>
                        <path d="M4 4.2748L4.0254 4.24658" stroke="#FEFADD" stroke-width="8" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M4 19.514L4.0254 19.4858L4 19.514Z" fill="white"/>
                        <path d="M4 19.514L4.0254 19.4858" stroke="#FEFADD" stroke-width="8" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M4 34.7533L4.0254 34.7251L4 34.7533Z" fill="white"/>
                        <path d="M4 34.7533L4.0254 34.7251" stroke="#FEFADD" stroke-width="8" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M14.1594 19.4888H44.6378H14.1594Z" fill="white"/>
                        <path d="M14.1594 19.4888H44.6378" stroke="#FEFADD" stroke-width="8" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M14.1594 34.728H44.6378H14.1594Z" fill="white"/>
                        <path d="M14.1594 34.728H44.6378" stroke="#FEFADD" stroke-width="8" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>    
                </button>
            </div>

            <div class="absolute hidden right-0 z-10 mt-5 w-56 origin-top-right rounded-md bg-orange-100 border-4 border-yellow-900 focus:outline-none" role="menu" aria-orientation="vertical" aria-labelledby="menu-button" tabindex="-1" id="modalFilter">
                <div class="py-1" role="none">
                  <!-- Active: "bg-gray-100 text-gray-900", Not Active: "text-gray-700" -->
                  <p class=" ml-2 text-yellow-900">Search filtered by (only can choose one)</p>
                  <!-- Active: "bg-gray-100 text-gray-900", Not Active: "text-gray-700" -->
                  
                    <div class="inline-flex items-center">
                        <label
                        class="relative flex items-center p-3 rounded-full cursor-pointer"
                        for="author">
                        <input
                            id="author"
                            type="checkbox"
                            class="before:content[''] peer relative h-5 w-5 cursor-pointer appearance-none rounded-md border-4 border-yellow-900 transition-all before:absolute before:top-2/4 before:left-2/4 before:block before:h-12 before:w-12 before:-translate-y-2/4 before:-translate-x-2/4 before:rounded-full before:border-yellow-900 before:opacity-0 before:transition-opacity checked:border-pink-500 checked:bg-pink-500 checked:before:bg-pink-500 hover:before:opacity-10"
                        />
                        <div class="absolute text-white transition-opacity opacity-0 pointer-events-none top-2/4 left-2/4 -translate-y-2/4 -translate-x-2/4 peer-checked:opacity-100">
                            <svg
                            xmlns="http://www.w3.org/2000/svg"
                            class="h-3.5 w-3.5"
                            viewBox="0 0 20 20"
                            fill="currentColor"
                            stroke="currentColor"
                            stroke-width="1"
                            >
                            <path
                                fill-rule="evenodd"
                                d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                                clip-rule="evenodd"
                            ></path>
                            </svg>
                        </div>
                        </label>
                        <label
                        class="mr-5 text-yellow-900 cursor-pointer select-none"
                        for="author"
                        >
                        Author
                        </label> 
                    </div>      
                    <div class="inline-flex items-center">
                        <label
                        class="relative flex items-center p-3 rounded-full cursor-pointer"
                        for="Category">
                        <input
                            id="Category"
                            type="checkbox"
                            class="before:content[''] peer relative h-5 w-5 cursor-pointer appearance-none rounded-md border-4 border-yellow-900 transition-all before:absolute before:top-2/4 before:left-2/4 before:block before:h-12 before:w-12 before:-translate-y-2/4 before:-translate-x-2/4 before:rounded-full before:border-yellow-900 before:opacity-0 before:transition-opacity checked:border-pink-500 checked:bg-pink-500 checked:before:bg-pink-500 hover:before:opacity-10"
                        />
                        <div class="absolute text-white transition-opacity opacity-0 pointer-events-none top-2/4 left-2/4 -translate-y-2/4 -translate-x-2/4 peer-checked:opacity-100">
                            <svg
                            xmlns="http://www.w3.org/2000/svg"
                            class="h-3.5 w-3.5"
                            viewBox="0 0 20 20"
                            fill="currentColor"
                            stroke="currentColor"
                            stroke-width="1"
                            >
                            <path
                                fill-rule="evenodd"
                                d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                                clip-rule="evenodd"
                            ></path>
                            </svg>
                        </div>
                        </label>
                        <label
                        class="mr-5 text-yellow-900 cursor-pointer select-none"
                        for="Category"
                        >
                        Category
                        </label> 
                    </div>   
                </div>
              </div>
            </div>
        </div>
        
    </div>

</div>

<script>
    document.getElementById('get_books_json').addEventListener('click', async(event) => {

    })

    const checkboxes = document.querySelectorAll('input[type="checkbox"]');

// Menambahkan event listener untuk setiap checkbox
checkboxes.forEach(checkbox => {
    checkbox.addEventListener('change', function() {
        if (this.checked) {
            // Membatalkan pilihan pada checkbox lain
            checkboxes.forEach(otherCheckbox => {
                if (otherCheckbox !== this) {
                    otherCheckbox.checked = false;
                }
            });
        }
    });
});

$(document).ready(function() {
            $("#showPopUpFilter").click(function() {
                $("#modalFilter").toggleClass("hidden"); // Menggunakan toggleClass untuk mengganti class 'hidden'
            });
        });

async function getProducts() {
    return fetch("{% url 'catalog:get_books_json' %}").then((res) => res.json())
}

async function refreshProducts(){
    const product = await getProducts()
    document.getElementById("data_books").innerHTML = ""
    let htmlString = ""
    product.forEach((item) => {
        htmlString += `<div class=" px-2 flex flex-col rounded-lg shadow-md w-100 m-6 overflow-hidden text-center bg-orange-100 border-4 border-yellow-900">
        
        <div class=" px-20 pt-4">
            <img src="${item.fields.image_link}">
        </div>
        <div class=" data text-2xl pr-1 pt-2">
            <h1>${item.fields.title}</h1>
        
        </div>
        <p class=" data pt-3 text-sm pb-2">Stock: <span class="ml-2">1</span></p>
       
        <div class="w-full pb-2">
            <button class="data text-yellow-900 w-40 border-4 border-yellow-900 rounded ">
                Details
            </button>
        </div>
       
        <div class="w-full pb-2">
            <button type = "button" class="data text-yellow-900 w-40 border-4 border-yellow-900 rounded" data-bs-toggle = "modal" data-bs-target= "#exampleModal" onclick = refreshReviews(${items.fields.id})>
                Review
            </button>
        </div>

        <!-- ini modal hehe -->
        <div class="fixed z-10 inset-0 overflow-y-auto" id="exampleModal" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
              <!-- Background overlay -->
              <div class="fixed inset-0 transition-opacity" aria-hidden="true">
                <div class="absolute inset-0 bg-gray-500 opacity-75"></div>
              </div>
              <!-- Modal panel -->
              <div class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full" role="dialog" aria-modal="true" aria-labelledby="modal-headline">
                <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                  <h1 class="text-2xl font-semibold mb-3" id="modal-headline">Write Your Review!</h1>
                  <form id="form" onsubmit="return false;">
                    {% csrf_token %}
                    <div class="mb-4">
                      <label for="stars" class="block text-gray-700 text-sm font-bold">Stars</label>
                      <input type="number" class="form-input mt-1 block w-full" id="stars" name="stars" />
                    </div>
                    <div class="mb-4">
                      <label for="review" class="block text-gray-700 text-sm font-bold">Review</label>
                      <textarea class="form-textarea mt-1 block w-full" id="review" name="review"></textarea>
                    </div> 
                  </form>
                </div>
                <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                  <button type="button" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-gray-800 text-base font-medium text-white hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 sm:ml-3 sm:w-auto sm:text-sm" id="button_add" aria-label="Add Product">Add Review</button>
                  <button type="button" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 sm:mt-0 sm:w-auto sm:text-sm" data-dismiss="modal">Close</button>
                </div>
              </div>
            </div>
          </div>
    </div>      
`
    })
    document.getElementById("data_books").innerHTML = htmlString
}

refreshProducts()

async function refreshReviews() {
        document.getElementById("product_table").innerHTML = ""
        const reviews = await getBookReviews()
        let htmlString = `<tr>
            <th>User</th>
            <th>Content</th>
            <th>Stars</th>
            <th>Date Added</th>
        </tr>`
        products.forEach((item) => {
            htmlString += `\n<tr>
            <td>${item.fields.user}</td>
            <td>${item.fields.content}</td>
            <td>${item.fields.stars}</td>
            <td>${item.fields.date_added}</td>
        </tr>` 
        })
        
        document.getElementById("product_table").innerHTML = htmlString
    }

    refreshReviews()

</script>

{% endblock %}